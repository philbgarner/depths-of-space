!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tactics=t():e.tactics=t()}(self,(()=>(()=>{"use strict";var e={d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Start:()=>V,StartMainMenu:()=>Q,pointer:()=>W});const a=JSON.parse('[{"name":"background","image":null,"filename":"./images/Background-sheet.png"}]');var r=null;function n(e){r=e}function i(){return r}const l=JSON.parse('{"background":{"default":"idle","idle":{"repeat":true,"imageName":"background","frameDelay":500,"frames":[{"x":0,"y":0,"w":320,"h":200},{"x":320,"y":0,"w":320,"h":200},{"x":640,"y":0,"w":320,"h":200},{"x":960,"y":0,"w":320,"h":200},{"x":1280,"y":0,"w":320,"h":200},{"x":1600,"y":0,"w":320,"h":200},{"x":1280,"y":0,"w":320,"h":200},{"x":960,"y":0,"w":320,"h":200},{"x":640,"y":0,"w":320,"h":200},{"x":320,"y":0,"w":320,"h":200}]}}}');function c(e){return e-new Date(e).setHours(0,0,0,0)}let o=null,s=null,d="";const f=JSON.parse('{"d":{"moveUp":"ArrowUp","moveDown":"ArrowDown","moveLeft":"ArrowLeft","moveRight":"ArrowRight","attack":" ","select":"Shift","cancel":"Escape"},"v":{"moveUp":"button12","moveDown":"button13","moveLeft":"button14","moveRight":"button15","attack":"button0","select":"button7","cancel":"button1"}}');var u=!1;function m(e){S(e,!1),p[e]&&p[e](e)}var h={},p={},g=["keyboard","gamepad"];function S(e,t){h[e]=t}function y(e){if(!u)return;let t=Object.keys(f.d);for(let a in t)e.key===f.d[t[a]]&&S(t[a],!0)}function b(e){if(!u)return;let t=Object.keys(f.d);for(let a in t)e.key===f.d[t[a]]&&m(t[a])}h={},p={},g.includes("keyboard")&&(window.removeEventListener("keydown",y),window.removeEventListener("keyup",b),window.addEventListener("keydown",y),window.addEventListener("keyup",b)),g.includes("gamepad")&&gameControl.on("connect",(function(e){let t=Object.keys(f.v);for(let a in t)e.on(f.v[t[a]],(()=>{})).after(f.v[t[a]],(()=>{m(t[a])}))})),u=!1;const w={listen:()=>{u=!0},unlisten:()=>{u=!1},released:(e,t)=>{p[e]=t}},x=JSON.parse('[{"name":"Overseer","Cost":4,"equipAbilities":6,"gunnerySkill":5,"meleeSkill":5,"speed":4,"hp":22},{"name":"Trooper","Cost":1,"equipAbilities":4,"gunnerySkill":5,"meleeSkill":6,"speed":4,"hp":16},{"name":"Artillerist","Cost":3,"equipAbilities":5,"gunnerySkill":4,"meleeSkill":7,"speed":3,"hp":18},{"name":"Recon","Cost":2,"equipAbilities":5,"gunnerySkill":8,"meleeSkill":4,"speed":6,"hp":16},{"name":"Technician","Cost":2,"equipAbilities":7,"gunnerySkill":7,"meleeSkill":8,"speed":3,"hp":14},{"name":"Medic","Cost":4,"equipAbilities":7,"gunnerySkill":6,"meleeSkill":7,"speed":4,"hp":20},{"name":"Herald","Cost":3,"equipAbilities":8,"gunnerySkill":8,"meleeSkill":6,"speed":4,"hp":14},{"name":"Crusader","Cost":5,"equipAbilities":7,"gunnerySkill":6,"meleeSkill":5,"speed":5,"hp":25},{"name":"Bastion","Cost":3,"equipAbilities":5,"gunnerySkill":6,"meleeSkill":4,"speed":3,"hp":28}]');class k{constructor(e){try{this.data=x.filter((t=>t.name===e))[0],this.data.maxHp=this.data.hp,this.name=this.data.name,this.equipment=[]}catch{this.data={},console.error(`Could not locate template for ${e}.`)}this.effectModifiers={},this.effects=[]}UpdateEffects(){for(let e in this.effects){let t=this.effects[e];t.ttl&&t.ttl--,t.ttl<=0&&this.RemoveEffectModifier(t)}this.effects=this.effects.filter((e=>e.ttl>0))}AddEffect(e){e.ttl&&this.effects.push(e),void 0!==e.attribute&&this.AddEffectModifier(e.attribute,e.amount)}RemoveEffectModifier(e){void 0!==e.attribute&&this.AddEffect(e.attribute,-1*e.amount)}AddEffectModifier(e,t){void 0===this.effectModifiers[e]&&(this.effectModifiers[e]=0),this.effectModifiers[e]+=t}EffectModifier(e){return void 0!==this.effectModifiers[e]?this.effectModifiers[e]:0}Name(){return this.data.name}Cost(){return this.data.Cost+this.EffectModifier("cost")}EquipmentAndAbilities(e){return void 0!==e&&(this.data.equipAbilities=e),this.data.equipAbilities+this.EffectModifier("equipAbilities")}GunnerySkill(){return this.data.gunnerySkill+this.EffectModifier("gunnerySkill")}MeleeSkill(){return this.data.meleeSkill+this.EffectModifier("meleeSkill")}Speed(){return this.data.speed+this.EffectModifier("speed")}Hp(){return this.data.hp+this.EffectModifier("hp")}MaxHp(){return this.data.maxHp+this.EffectModifier("maxHp")}}const C=JSON.parse('[{"id":"Main","Style":{"Color":"#c1c1c1ff","SelectColor":"#f1f1f1ff","SelectableColor":"#ccccccff","Disabled":"#4a4a4aff"},"Options":[{"text":"Start","onSelect":"menu_GameSetup","width":"90%"},{"text":"Settings","onSelect":"menu_Settings","width":"90%"},{"text":"Credits","onSelect":"menu_Credits","width":"90%"}]},{"id":"GameSetup","Style":{"Color":"#a0a0a0ff","SelectColor":"#f1f1f1ff","SelectableColor":"#ccccccff","Disabled":"#4a4a4aff"},"Options":[{"text":"Hire Squad ({0} hired)","onRender":"callback_OnRenderHireSquad","width":"90%"},{"text":"Stars: {0}","onRender":"callback_OnRenderStars","width":"90%"},{"text":"Overseer (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Trooper (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Artillerist (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Recon (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Technician (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Medic (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Herald (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Crusader (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Bastion (x{0})","onRender":"callback_OnRenderCharacter","onSelect":"callback_HireCharacter","width":"90%"},{"text":"Next","onSelect":"callback_SetupEquipment","width":"90%","column":0}]},{"id":"SetupEquipment","Style":{"Color":"#a0a0a0ff","SelectColor":"#f1f1f1ff","SelectableColor":"#ccccccff","Disabled":"#4a4a4aff"},"Columns":2,"Options":[{"text":"Next","onSelect":"callback_StartGame","width":160,"column":0}]},{"id":"Settings","onLoad":"callback_StartSettings","Options":[{"text":"Input Type","width":"90%"}]}]'),v=JSON.parse('[{"name":"Phaser Pistol","attacks":4,"damage":1,"range":10,"reload":true,"cost":1,"characters":["Overseer","Trooper","Artillerist","Recon","Technician","Medic","Herald","Crusader","Bastion"],"effects":[]},{"name":"Slug Revolver","attacks":2,"damage":2,"range":6,"reload":true,"cost":1,"characters":["Crusader","Artillerist","Crusader","Bastion"],"effects":[]},{"name":"Phaser Rifle","attacks":4,"damage":2,"range":20,"reload":true,"cost":2,"characters":["Overseer","Trooper","Artillerist","Crusader","Bastion"],"effects":[]},{"name":"Slugger","attacks":2,"damage":5,"range":10,"reload":true,"cost":2,"characters":["Trooper","Artillerist","Crusader","Bastion"],"effects":[]},{"name":"Beam Rifle","attacks":3,"damage":3,"range":24,"reload":true,"cost":2,"characters":["Overseer","Artillerist","Recon","Technician","Crusader","Bastion"],"effects":[]},{"name":"Solumide Burner","attacks":2,"damage":3,"range":6,"reload":true,"cost":2,"characters":["Trooper","Artillerist","Technician","Herald","Crusader"],"effects":[]},{"name":"Phaser Cannon","attacks":1,"damage":6,"range":20,"reload":true,"cost":2,"characters":["Artillerist","Crusader","Bastion"],"effects":[]},{"name":"Heavy Rotary Rifle","attacks":10,"damage":1,"range":20,"reload":true,"cost":3,"characters":["Artillerist","Bastion"],"effects":[]},{"name":"Heavy Slug Cannon","attacks":2,"damage":6,"range":14,"reload":true,"cost":3,"characters":["Artillerist","Crusader"],"effects":[]},{"name":"Incendiary Cannon","attacks":4,"damage":2,"range":24,"reload":true,"cost":3,"characters":["Artillerist","Crusader"],"effects":[]},{"name":"Long-Range Phaser Rifle","attacks":1,"damage":8,"range":36,"reload":true,"cost":3,"characters":["Trooper","Artillerist","Recon"],"effects":[]},{"name":"Force Grenade","attacks":1,"damage":8,"range":12,"cost":2,"characters":["Overseer","Trooper","Artillerist","Recon","Technician","Medic","Herald","Crusader","Bastion"],"effects":[]},{"name":"Flash Grenade","attacks":1,"damage":0,"range":12,"diameter":12,"thrown":true,"cost":2,"characters":["Overseer","Trooper","Artillerist","Recon","Technician","Medic","Herald","Crusader","Bastion"],"effects":[{"disadvantage":true,"target":"targets","ttl":"next-siege-phase"}]},{"name":"Saw Sword","attacks":2,"damage":2,"range":0,"cost":1,"characters":["Overseer","Trooper","Artillerist","Recon","Technician","Medic","Herald","Crusader","Bastion"],"effects":[]},{"name":"Force Hammer","attacks":1,"damage":4,"range":0,"cost":2,"characters":["Crusader","Bastion"],"effects":[]},{"name":"Righteous Ax","attacks":2,"damage":3,"range":0,"cost":2,"characters":["Overseer","Trooper","Herald","Crusader","Bastion"],"effects":[]},{"name":"Assassin\'s Knife","attacks":3,"damage":1,"range":0,"cost":1,"characters":["Recon"],"effects":[{"damage":1,"target":"enemy","ttl":"next-2-siege-phase"}]},{"name":"Dueling Blades","attacks":3,"damage":2,"range":0,"cost":2,"characters":["Overseer","Recon","Herald","Crusader"],"effects":[]},{"name":"Powered Titanium Fists","attacks":4,"damage":2,"range":0,"cost":3,"characters":["Overseer","Trooper","Crusader","Bastion"],"effects":[]},{"name":"Warding Staff","attacks":2,"damage":2,"range":0,"cost":3,"characters":["Overseer","Herald"],"effects":[{"advantage":true,"target":"abilities","ttl":0}]},{"name":"Powered Titanium Armor","cost":3,"characters":["Crusader","Bastion"],"effects":[{"attribute":"speed","target":"self","amount":-2,"ttl":0}]},{"name":"Powered Titanium Boots","cost":2,"characters":["Overseer","Recon","Crusader","Bastion"],"effects":[{"attribute":"speed","target":"self","amount":2,"ttl":0}]},{"name":"Laser Scope","cost":3,"characters":["Overseer","Trooper","Recon","Technician"],"effects":[]},{"name":"Thermal Scope","cost":3,"characters":["Overseer","Trooper","Recon","Technician"],"effects":[]},{"name":"Suture Kit","cost":3,"characters":["Overseer","Medic"],"effects":[]},{"name":"Cauterizing Torch","attacks":3,"damage":2,"range":4,"cost":5,"characters":["Medic"],"effects":[]}]');let R=null,A=null;var O=16,E=[],q=function(e,t,n,i,o){if(!l[e])throw new Error(`Can't build sprite, missing animation definition '${e}'.`);let s={name:e,x:0,y:0,frames:[],pose:i,framesImage:null,currentFrame:0,updateDelta:0,play:!0,SetAnimation:(e,t,r)=>{s.animStartTime=c(new Date);let n=l[e];if(r&&(s.onComplete=r),n){let r=n.default?n.default:null;if(r=n[t]?n[t]:r,r){if(!(a.filter((e=>e.name===r.imageName)).length>0))throw new Error(`Can't find pose ${t} in ${e}.`);if(s.frames=r.frames,s.currentFrame=0,s.animation=e,s.pose=t,s.framesImage=r.imageName,r.sfx){let e=getSfx(r.sfx);e&&e.play()}}else s.frames=[],s.currentFrame=0,s.animation="",s.pose="";s.play=!0}},draw:(e,t)=>{e=e||0,t=t||0,function(e,t,n,i){let l=a.filter((t=>t.name===e));l.length>0&&(i?r.drawImage(l[0].image,i.x,i.y,i.w,i.h,t,n,i.w,i.h):r.drawImage(l[0].image,t,n))}(s.framesImage,s.x+e,s.y+t,s.frames[s.currentFrame])},moveTo:async(e,t,a)=>new Promise((async(r,n)=>{let i=s,l=i.x,c=i.y,o=a,d=0;var f,u;await(f=e,u=t,new Promise(((a,r)=>{let n=()=>{if(d+=o,d>=1)i.x=e,i.y=t,a();else{let e={x:(1-(m=d))*(r={x:l,y:c}).x+m*(s={x:f,y:u}).x,y:(1-m)*r.y+m*s.y};i.x=e.x,i.y=e.y,setTimeout(n,16)}var r,s,m};setTimeout(n,16)}))),r()})),onComplete:e=>{},update:e=>{let t=l[s.animation][s.pose];t&&s.play&&(s.updateDelta>t.frameDelay?(s.currentFrame++,s.currentFrame>s.frames.length-1&&(t.repeat?(s.currentFrame=0,s.animDuration=c(new Date)-s.animStartTime,s.onComplete(s)):(s.animDuration=c(new Date)-s.animStartTime,s.currentFrame--,s.play=!1,s.onComplete(s)),t.onComplete&&t.onComplete(s)),s.updateDelta=0):s.updateDelta+=e)}};return s.SetAnimation(e,i),s}("background",0,0,"idle"),T=[],_={},H="Main",M="Start",D=0,B=null,I={callback_OnRenderStars:(e,t)=>[O.toString()],callback_OnRenderHireSquad:(e,t)=>[E.length],callback_OnRenderCharacter:(e,t)=>{let a=e.split(" ")[0].replace(">","");return[E.filter((e=>e.name===a)).length]},callback_HireCharacter:e=>{let t=e.split(" ")[0].replace(">",""),a=new k(t);O-a.Cost()>=0&&(E.push(a),O-=a.Cost())},callback_StartGame:()=>{console.log("callback_StartGame"),V()},callback_SelectCharacterEquip:e=>{B=e},callback_SetupEquipment:e=>{L("SetupEquipment");let t=C.filter((e=>"SetupEquipment"===e.id))[0],a=t.Options.findIndex((e=>"Next"===e.text));t.Options=[...E.map(((e,t)=>({text:`${t+1}. ${e.name}`,onSelect:"callback_SelectCharacterEquip",width:160,column:0}))),t.Options[a]]}};let P=0,$=0;function F(e){return e.includes("callback_")?I[e]?I[e]:()=>{}:(e.includes("menu_")&&L(e.split("_")[1]),()=>{})}function L(e){w.unlisten(),D=0,H=e;let t=N(e);w.listen(),_=t.filter((e=>e.text===M))[0]}function N(e){let t=j(e).Options.filter((e=>e.onSelect&&(void 0===e.column||e.column===D)));return t.length>0&&""===M&&(M=t[0].text),t}function j(e){try{return C.filter((t=>t.id===e))[0]}catch{return null}}function U(e,t){let a=e.split(/{[0-9]}/),r=[];for(let e in a)r.push(`{${e}}`);let n=F(t)(e,a);for(let t in n)e=e.replace(r[t],n[t]);return e}var G=Date.now(),J=Date.now(),z=16,K="mainMenu",W={x:0,y:0};function X(e){z=parseInt(1e3/e)}function Y(){let e=(G=Date.now())-J;e>=z&&(function(e){"mainMenu"===K?function(e){A||(A=i()),q.draw(0,0),q.update(e),R||(R=new imui.ImUI(A.canvas),R.font=font,R.onUpdate=e=>{let t=j(H),a=t.Options.sort(((e,t)=>void 0!==t.column?t.column:0-e.column!==void 0?e.column:0)),r=$+30;for(let n in a){let i=a[n].text,l=a[n],c=i===M?t.Style.SelectColor:l.onSelect?t.Style.SelectableColor:t.Style.Color,o=`${M===i?">":" "}${i}${M===i?"<":" "}`;o.includes("{")&&o.includes("}")&&l.onRender&&(o=U(o,l.onRender));let s=e.Element({id:"lblMenu"+H+i+n,text:o,rect:{x:P,y:r,w:64,h:8},color:c,highlight:c,bgcolor:"#cccccc00"});s.Hover()&&l.onSelect&&(M=i),s.Clicked()&&l.onSelect&&(M=o,F(l.onSelect)(l.text)),r+=12}if("SetupEquipment"===H&&e.Element({id:"lblEquipMenu",text:"Squad Equipment",rect:{x:P,y:$+15,w:128,h:8},color:t.Style.Color,highlight:t.Style.Color,bgcolor:"#cccccc00"}),B&&"SetupEquipment"===H){let a="";r=$+42;let n=80,i=B.split(".")[1].trim(),l=parseInt(B.split("."))-1,c=E[l].EquipmentAndAbilities(),o=(e.Element({id:"lblSelEquip",text:`${i}: Equip & Ability Points: ${c}`,rect:{x:n,y:$+30,w:128,h:8},color:t.Style.Color,highlight:t.Style.Color,bgcolor:"#cccccc00"}),v.filter((e=>e.characters.includes(i))));for(let i in o){let s=o[i],d=E[l].equipment.filter((e=>s.name===e.name)),f=t.Style.SelectableColor;d.length>0&&(f=t.Style.Disabled);let u=e.Element({id:"lblEquip"+H+s.name+i,text:s.name,rect:{x:n,y:r,w:128,h:8},color:f,highlight:f,bgcolor:"#cccccc00"});if(u.Hover()){let e=[`Attacks: ${s.attacks}`,`Damage: ${s.damage}`,`Range: ${s.range}`,`Cost: ${s.cost}`];s.reload&&e.push("Requires Reload"),a=e.join("\n")}u.Clicked()&&(d.length>0?(E[l].equipment=E[l].equipment.filter((e=>e.name!==s.name)),E[l].EquipmentAndAbilities(c+s.cost)):c-s.cost>=0&&(E[l].equipment.push(s),E[l].EquipmentAndAbilities(c-s.cost))),r+=12,r>180&&(r=$+42,n+=90)}a&&(e.RemoveElement("lblTooltip"),e.Element({id:"lblTooltip",text:a,x:W.x,y:W.y+8,autosize:!0,color:t.Style.SelectableColor,highlight:t.Style.SelectColor,bgcolor:"#000000dd"}))}}),R.Draw()}(e):"main"===K&&(s||(s=i()),s.clearRect(0,0,320,200),o||(o=new imui.ImUI(s.canvas),o.font=font,o.onUpdate=e=>{e.Element({id:"lblTooltip",text:d,rect:{x:0,y:0,w:240,h:10},color:"#f1f1f1ff",highlight:"#f1f1f1ff",bgcolor:"#cccccc00"})}),o.Draw())}(e),J=G),window.requestAnimationFrame(Y)}async function Q(){await function(){let e=[];for(let t in a){let r=a[t];e.push(new Promise(((e,t)=>{return(n=r.filename,new Promise(((e,t)=>{let r=new Image;r.onload=t=>{e(r)},r.onerror=e=>{console.error(`Failed to load file ${n}:`,e),t(null)},a.filter((e=>e.filename===n)).length>0?r.src=n:(console.error(`Image definition matching filename ${n} not found.`),t(null))}))).then((t=>{r.image=t,e(t)})).catch((e=>console.error("Failed to load",r.filename,e)));var n})))}return Promise.allSettled(e)}();let e=document.getElementById("maincanvas"),t=e.width/e.height;e.style.height=window.innerHeight+"px",e.style.width=window.innerHeight*t+"px",window.addEventListener("resize",(()=>{e.style.height=window.innerHeight+"px",e.style.width=window.innerHeight*t+"px"})),e.addEventListener("mousemove",(t=>{W.x=parseInt((t.clientX-e.offsetLeft)*(e.width/parseInt(e.style.width)))-2,W.y=parseInt((t.clientY-e.offsetTop)*(e.height/parseInt(e.style.height)))})),e.addEventListener("contextmenu",(e=>(e.preventDefault(),!1))),X(60),n(e.getContext("2d")),w.listen(),w.released("moveDown",(()=>{j(H),T=N(H),_=T.filter((e=>e.text===M))[0];let e=T.findIndex((e=>e.text===M));e++,e>=T.length&&(e=0),M=T[e].text})),w.released("moveUp",(()=>{j(H),T=N(H),_=T.filter((e=>e.text===M))[0];let e=T.findIndex((e=>e.text===M));e--,e<0&&(e=T.length-1),M=T[e].text})),w.released("attack",(()=>{j(H),T=N(H);try{(_=T.filter((e=>e.text===M))[0]).onSelect&&F(_.onSelect)(_.text)}catch{}})),window.requestAnimationFrame(Y)}async function V(){w.unlisten();let e=document.getElementById("maincanvas");K="main",X(60),n(e.getContext("2d")),window.requestAnimationFrame(Y)}return t})()));
//# sourceMappingURL=tactics.js.map